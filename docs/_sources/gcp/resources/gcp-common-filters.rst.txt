.. File Generated By c7n-sphinxext from source. Do not edit.

GCP Common Filters
==================

Filters


   - :ref:`effective-firewall <GCP.common.filters.effective-firewall>`


   - :ref:`event <GCP.common.filters.event>`


   - :ref:`offhour <GCP.common.filters.offhour>`


   - :ref:`onhour <GCP.common.filters.onhour>`


   - :ref:`reduce <GCP.common.filters.reduce>`


   - :ref:`scc-findings <GCP.common.filters.scc-findings>`


   - :ref:`value <GCP.common.filters.value>`




.. _GCP.common.filters.effective-firewall:

effective-firewall
++++++++++++++++++

Filters instances by their effective firewall rules.
See `getEffectiveFirewalls
<https://cloud.google.com/compute/docs/reference/rest/v1/instances/getEffectiveFirewalls>`_
for valid fields.

:example:

Filter all instances that have a firewall rule that allows public
acess

.. code-block:: yaml

    policies:
       - name: find-publicly-accessable-instances
         resource: gcp.instance
         filters:
         - type: effective-firewall
           key: firewalls[*].sourceRanges[]
           op: contains
           value: "0.0.0.0/0"

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - effective-firewall
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _GCP.common.filters.event:

event
+++++

Filter a resource based on an event.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - event
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _GCP.common.filters.offhour:

offhour
+++++++

Schedule offhours for resources see :ref:`offhours <offhours>`
for features and configuration.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default_tz:
        type: string
      fallback_schedule:
        type: string
      offhour:
        maximum: 23
        minimum: 0
        type: integer
      opt-out:
        type: boolean
      skip-days:
        items:
          pattern: ^[0-9]{4}-[0-9]{2}-[0-9]{2}
          type: string
        type: array
      skip-days-from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      tag:
        type: string
      type:
        enum:
        - offhour
      weekends:
        type: boolean
      weekends-only:
        type: boolean
    required:
    - offhour
    - default_tz
    - type



.. _GCP.common.filters.onhour:

onhour
++++++

Schedule offhours for resources see :ref:`offhours <offhours>`
for features and configuration.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default_tz:
        type: string
      fallback_schedule:
        type: string
      onhour:
        maximum: 23
        minimum: 0
        type: integer
      opt-out:
        type: boolean
      skip-days:
        items:
          pattern: ^[0-9]{4}-[0-9]{2}-[0-9]{2}
          type: string
        type: array
      skip-days-from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      tag:
        type: string
      type:
        enum:
        - onhour
      weekends:
        type: boolean
      weekends-only:
        type: boolean
    required:
    - onhour
    - default_tz
    - type



.. _GCP.common.filters.reduce:

reduce
++++++

Generic reduce filter to group, sort, and limit your resources.

This example will select the longest running instance from each ASG,
then randomly choose 10% of those, maxing at 15 total instances.

:example:

.. code-block:: yaml

  - name: oldest-instance-by-asg
    resource: ec2
    filters:
      - "tag:aws:autoscaling:groupName": present
      - type: reduce
        group-by: "tag:aws:autoscaling:groupName"
        sort-by: "LaunchTime"
        order: asc
        limit: 1

Or you might want to randomly select a 10 percent of your resources,
but no more than 15.

:example:

.. code-block:: yaml

  - name: random-selection
    resource: ec2
    filters:
      - type: reduce
        order: randomize
        limit: 15
        limit-percent: 10

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      discard:
        minimum: 0
        type: number
      discard-percent:
        maximum: 100
        minimum: 0
        type: number
      group-by:
        oneOf:
        - type: string
        - key:
            type: string
          type: object
          value_regex: string
          value_type:
            enum:
            - string
            - number
            - date
      limit:
        minimum: 0
        type: number
      limit-percent:
        maximum: 100
        minimum: 0
        type: number
      null-order:
        enum:
        - first
        - last
      order:
        enum:
        - asc
        - desc
        - reverse
        - randomize
      sort-by:
        oneOf:
        - type: string
        - key:
            type: string
          type: object
          value_regex: string
          value_type:
            enum:
            - string
            - number
            - date
      type:
        enum:
        - reduce
    required:
    - type



.. _GCP.common.filters.scc-findings:

scc-findings
++++++++++++

Filters resources based on their Security Command Center (SCC) findings.

.. code-block:: yaml

  - name: bucket-contains-high-finding
    resource: gcp.bucket
    filters:
    - type: scc-findings
      org: 11111111111111
      key: severity
      value: HIGH

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      org:
        type: integer
      type:
        enum:
        - scc-findings
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - org
    - type



.. _GCP.common.filters.value:

value
+++++

Generic value filter using jmespath
    

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - value
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type


