.. File Generated By c7n-sphinxext from source. Do not edit.

.. _aws.ebs-snapshot:

aws.ebs-snapshot
================




Filters
-------


  - :ref:`age <aws.ebs-snapshot.filters.age>`

  - :ref:`cross-account <aws.ebs-snapshot.filters.cross-account>`

  - :ref:`event <aws.common.filters.event>`
  
  - :ref:`finding <aws.common.filters.finding>`
  
  - :ref:`marked-for-op <aws.common.filters.marked-for-op>`
  
  - :ref:`ops-item <aws.common.filters.ops-item>`
  
  - :ref:`reduce <aws.common.filters.reduce>`
  
  - :ref:`skip-ami-snapshots <aws.ebs-snapshot.filters.skip-ami-snapshots>`

  - :ref:`tag-count <aws.common.filters.tag-count>`
  
  - :ref:`unused <aws.ebs-snapshot.filters.unused>`

  - :ref:`value <aws.common.filters.value>`
  
  - :ref:`volume <aws.ebs-snapshot.filters.volume>`



.. _aws.ebs-snapshot.filters.age:

age
+++
EBS Snapshot Age Filter

Filters an EBS snapshot based on the age of the snapshot (in days)

:example:

.. code-block:: yaml

        policies:
          - name: ebs-snapshots-week-old
            resource: ebs-snapshot
            filters:
              - type: age
                days: 7
                op: ge

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      days:
        type: number
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - age
    required:
    - type





.. _aws.ebs-snapshot.filters.cross-account:

cross-account
+++++++++++++
Check a resource's embedded iam policy for cross account access.
    

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      actions:
        items:
          type: string
        type: array
      everyone_only:
        type: boolean
      type:
        enum:
        - cross-account
      whitelist:
        items:
          type: string
        type: array
      whitelist_conditions:
        items:
          type: string
        type: array
      whitelist_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      whitelist_orgids:
        items:
          type: string
        type: array
      whitelist_orgids_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      whitelist_vpc:
        items:
          type: string
        type: array
      whitelist_vpc_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      whitelist_vpce:
        items:
          type: string
        type: array
      whitelist_vpce_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
    required:
    - type




Permissions - ec2:DescribeSnapshotAttribute


.. _aws.ebs-snapshot.filters.skip-ami-snapshots:

skip-ami-snapshots
++++++++++++++++++
Filter to remove snapshots of AMIs from results

This filter is 'true' by default.

:example:

implicit with no parameters, 'true' by default

.. code-block:: yaml

        policies:
          - name: delete-ebs-stale-snapshots
            resource: ebs-snapshot
            filters:
              - type: age
                days: 28
                op: ge
              - skip-ami-snapshots

:example:

explicit with parameter

.. code-block:: yaml

        policies:
          - name: delete-snapshots
            resource: ebs-snapshot
            filters:
              - type: age
                days: 28
                op: ge
              - type: skip-ami-snapshots
                value: false

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      type:
        enum:
        - skip-ami-snapshots
      value:
        type: boolean
    required:
    - type




Permissions - ec2:DescribeImages


.. _aws.ebs-snapshot.filters.unused:

unused
++++++
Filters snapshots based on usage

true: snapshot is not used by launch-template, launch-config, or ami.

false: snapshot is being used by launch-template, launch-config, or ami.

:example:

.. code-block:: yaml

        policies:
          - name: snapshot-unused
            resource: ebs-snapshot
            filters:
              - type: unused
                value: true

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      type:
        enum:
        - unused
      value:
        type: boolean
    required:
    - type




Permissions - autoscaling:DescribeAutoScalingGroups, autoscaling:DescribeLaunchConfigurations, ec2:DescribeImages


.. _aws.ebs-snapshot.filters.volume:

volume
++++++
Filter EBS snapshots by their volume attributes.

.. code-block:: yaml

    policies:
      - name: snapshot-with-no-volume
        description: Find any snapshots that do not have a corresponding volume.
        resource: aws.ebs-snapshot
        filters:
          - type: volume
            key: VolumeId
            value: absent
      - name: find-snapshots-from-volume
        resource: aws.ebs-snapshot
        filters:
          - type: volume
            key: VolumeId
            value: vol-foobarbaz

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - volume
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type




Permissions - ec2:DescribeVolumes




Actions
-------


  - :ref:`auto-tag-user <aws.common.actions.auto-tag-user>`
  
  - :ref:`copy <aws.ebs-snapshot.actions.copy>`

  - :ref:`copy-related-tag <aws.common.actions.copy-related-tag>`
  
  - :ref:`delete <aws.ebs-snapshot.actions.delete>`

  - :ref:`invoke-lambda <aws.common.actions.invoke-lambda>`
  
  - :ref:`invoke-sfn <aws.common.actions.invoke-sfn>`
  
  - :ref:`mark-for-op <aws.common.actions.mark-for-op>`
  
  - :ref:`normalize-tag <aws.common.actions.normalize-tag>`
  
  - :ref:`notify <aws.common.actions.notify>`
  
  - :ref:`post-finding <aws.common.actions.post-finding>`
  
  - :ref:`post-item <aws.common.actions.post-item>`
  
  - :ref:`put-metric <aws.common.actions.put-metric>`
  
  - :ref:`remove-tag <aws.common.actions.remove-tag>`
  
  - :ref:`rename-tag <aws.common.actions.rename-tag>`
  
  - :ref:`set-permissions <aws.ebs-snapshot.actions.set-permissions>`

  - :ref:`tag <aws.common.actions.tag>`
  
  - :ref:`tag-trim <aws.common.actions.tag-trim>`
  
  - :ref:`webhook <aws.common.actions.webhook>`
  



.. _aws.ebs-snapshot.actions.copy:

copy
++++
Copy a snapshot across regions

https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-copy-snapshot.html

:example:

.. code-block:: yaml

        policies:
          - name: copy-snapshot-east-west
            resource: ebs-snapshot
            filters:
              - type: age
                days: 7
                op: le
            actions:
              - type: copy
                target_region: us-west-2
                target_key: target_kms_key
                encrypted: true

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      encrypted:
        type: boolean
      target_key:
        type: string
      target_region:
        type: string
      type:
        enum:
        - copy
    required:
    - type




Permissions - ec2:CreateTags, ec2:CopySnapshot, ec2:DescribeSnapshots


.. _aws.ebs-snapshot.actions.delete:

delete
++++++
Deletes EBS snapshots

:example:

.. code-block:: yaml

        policies:
          - name: delete-stale-snapshots
            resource: ebs-snapshot
            filters:
              - type: age
                days: 28
                op: ge
            actions:
              - delete

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      skip-ami-snapshots:
        type: boolean
      type:
        enum:
        - delete
    required:
    - type




Permissions - ec2:DeleteSnapshot


.. _aws.ebs-snapshot.actions.set-permissions:

set-permissions
+++++++++++++++
Action to set permissions for creating volumes from a snapshot

Use the 'add' and 'remove' parameters to control which accounts to
add or remove respectively.  The default is to remove any create
volume permissions granted to other AWS accounts.

Combining this action with the 'cross-account' filter allows you
greater control over which accounts will be removed, e.g. using a
whitelist:

:example:

.. code-block:: yaml

        policies:
          - name: ebs-dont-share-cross-account
            resource: ebs-snapshot
            filters:
              - type: cross-account
                whitelist:
                - '112233445566'
            actions:
              - type: set-permissions
                remove: matched

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      add:
        items:
          maxLength: 12
          minLength: 12
          type: string
        type: array
      remove:
        oneOf:
        - enum:
          - matched
        - items:
            maxLength: 12
            minLength: 12
            type: string
          type: array
      type:
        enum:
        - set-permissions
    required:
    - type




Permissions - ec2:ModifySnapshotAttribute

