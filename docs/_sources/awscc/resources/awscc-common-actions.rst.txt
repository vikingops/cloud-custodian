.. File Generated By c7n-sphinxext from source. Do not edit.

AWS Cloud Control Common Actions
================================

Actions


   - :ref:`auto-tag-user <AWS Cloud Control.common.actions.auto-tag-user>`


   - :ref:`mark-for-op <AWS Cloud Control.common.actions.mark-for-op>`


   - :ref:`normalize-tag <AWS Cloud Control.common.actions.normalize-tag>`


   - :ref:`remove-tag <AWS Cloud Control.common.actions.remove-tag>`


   - :ref:`rename-tag <AWS Cloud Control.common.actions.rename-tag>`


   - :ref:`tag <AWS Cloud Control.common.actions.tag>`


   - :ref:`tag-trim <AWS Cloud Control.common.actions.tag-trim>`


   - :ref:`webhook <AWS Cloud Control.common.actions.webhook>`




.. _AWS Cloud Control.common.actions.auto-tag-user:

auto-tag-user
+++++++++++++

Tag a resource with the user who created/modified it.

.. code-block:: yaml

  policies:
    - name: ec2-auto-tag-ownercontact
      resource: ec2
      description: |
        Triggered when a new EC2 Instance is launched. Checks to see if
        it's missing the OwnerContact tag. If missing it gets created
        with the value of the ID of whomever called the RunInstances API
      mode:
        type: cloudtrail
        role: arn:aws:iam::123456789000:role/custodian-auto-tagger
        events:
          - RunInstances
      filters:
       - tag:OwnerContact: absent
      actions:
       - type: auto-tag-user
         tag: OwnerContact

There's a number of caveats to usage. Resources which don't
include tagging as part of their api may have some delay before
automation kicks in to create a tag. Real world delay may be several
minutes, with worst case into hours[0]. This creates a race condition
between auto tagging and automation.

In practice this window is on the order of a fraction of a second, as
we fetch the resource and evaluate the presence of the tag before
attempting to tag it.

References

 CloudTrail User
 https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-user-identity.html

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      principal_id_tag:
        type: string
      tag:
        type: string
      type:
        enum:
        - auto-tag-user
      update:
        type: boolean
      user-type:
        items:
          enum:
          - IAMUser
          - AssumedRole
          - FederatedUser
          type: string
        type: array
    required:
    - tag
    - type



.. _AWS Cloud Control.common.actions.mark-for-op:

mark-for-op
+++++++++++

Tag resources for future action.

The optional 'tz' parameter can be used to adjust the clock to align
with a given timezone. The default value is 'utc'.

If neither 'days' nor 'hours' is specified, Cloud Custodian will default
to marking the resource for action 4 days in the future.

.. code-block :: yaml

  policies:
    - name: ec2-mark-for-stop-in-future
      resource: ec2
      filters:
        - type: value
          key: Name
          value: instance-to-stop-in-four-days
      actions:
        - type: mark-for-op
          op: stop

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      days:
        minimum: 0
        type: number
      hours:
        minimum: 0
        type: number
      msg:
        type: string
      op:
        type: string
      tag:
        type: string
      type:
        enum:
        - mark-for-op
      tz:
        type: string
    required:
    - type



.. _AWS Cloud Control.common.actions.normalize-tag:

normalize-tag
+++++++++++++

Transform the value of a tag.

Set the tag value to uppercase, title, lowercase, or strip text
from a tag key.

.. code-block :: yaml

    policies:
      - name: ec2-service-transform-lower
        resource: ec2
        comment: |
          ec2-service-tag-value-to-lower
        query:
          - instance-state-name: running
        filters:
          - "tag:testing8882": present
        actions:
          - type: normalize-tag
            key: lower_key
            action: lower

      - name: ec2-service-strip
        resource: ec2
        comment: |
          ec2-service-tag-strip-blah
        query:
          - instance-state-name: running
        filters:
          - "tag:testing8882": present
        actions:
          - type: normalize-tag
            key: strip_key
            action: strip
            value: blah

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      action:
        items:
          enum:
          - upper
          - lower
          - titlestrip
          - replace
        type: string
      key:
        type: string
      type:
        enum:
        - normalize-tag
      value:
        type: string
    required:
    - type



.. _AWS Cloud Control.common.actions.remove-tag:

remove-tag
++++++++++

Remove tags from ec2 resources.
    

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      tags:
        items:
          type: string
        type: array
      type:
        enum:
        - remove-tag
        - unmark
        - untag
        - remove-tag
    required:
    - type



.. _AWS Cloud Control.common.actions.rename-tag:

rename-tag
++++++++++

Create a new tag with identical value & remove old tag
    

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      new_key:
        type: string
      old_key:
        type: string
      type:
        enum:
        - rename-tag
    required:
    - type



.. _AWS Cloud Control.common.actions.tag:

tag
+++

Tag an ec2 resource.
    

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      key:
        type: string
      tag:
        type: string
      tags:
        type: object
      type:
        enum:
        - tag
        - mark
      value:
        type: string
    required:
    - type



.. _AWS Cloud Control.common.actions.tag-trim:

tag-trim
++++++++

Automatically remove tags from an ec2 resource.

EC2 Resources have a limit of 50 tags, in order to make
additional tags space on a set of resources, this action can
be used to remove enough tags to make the desired amount of
space while preserving a given set of tags.

.. code-block :: yaml

   policies:
     - name: ec2-tag-trim
       comment: |
         Any instances with 48 or more tags get tags removed until
         they match the target tag count, in this case 47 so we
         that we free up a tag slot for another usage.
       resource: ec2
       filters:
             # Filter down to resources which already have 8 tags
             # as we need space for 3 more, this also ensures that
             # metrics reporting is correct for the policy.
           - type: value
             key: "length(Tags)"
             op: ge
             value: 48
       actions:
          - type: tag-trim
            space: 3
            preserve:
              - OwnerContact
              - ASV
              - CMDBEnvironment
              - downtime
              - custodian_status

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      preserve:
        items:
          type: string
        type: array
      space:
        type: integer
      type:
        enum:
        - tag-trim
    required:
    - type



.. _AWS Cloud Control.common.actions.webhook:

webhook
+++++++

Calls a webhook with optional parameters and body
populated from JMESPath queries.

 .. code-block:: yaml

   policies:
     - name: call-webhook
       resource: ec2
       description: |
         Call webhook with list of resource groups
       actions:
        - type: webhook
          url: http://foo.com
          query-params:
             resource_name: resource.name
             policy_name: policy.name

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      batch:
        type: boolean
      batch-size:
        type: number
      body:
        type: string
      headers:
        additionalProperties:
          description: header values
          type: string
        type: object
      method:
        enum:
        - PUT
        - POST
        - GET
        - PATCH
        - DELETE
        type: string
      query-params:
        additionalProperties:
          description: query string values
          type: string
        type: object
      type:
        enum:
        - webhook
      url:
        type: string
    required:
    - url
    - type


