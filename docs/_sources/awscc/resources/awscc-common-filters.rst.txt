.. File Generated By c7n-sphinxext from source. Do not edit.

AWS Cloud Control Common Filters
================================

Filters


   - :ref:`event <AWS Cloud Control.common.filters.event>`


   - :ref:`marked-for-op <AWS Cloud Control.common.filters.marked-for-op>`


   - :ref:`reduce <AWS Cloud Control.common.filters.reduce>`


   - :ref:`tag-count <AWS Cloud Control.common.filters.tag-count>`


   - :ref:`value <AWS Cloud Control.common.filters.value>`




.. _AWS Cloud Control.common.filters.event:

event
+++++

Filter a resource based on an event.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - event
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _AWS Cloud Control.common.filters.marked-for-op:

marked-for-op
+++++++++++++

Filter resources for tag specified future action

Filters resources by a 'maid_status' tag which specifies a future
date for an action.

The filter parses the tag values looking for an 'op@date'
string. The date is parsed and compared to do today's date, the
filter succeeds if today's date is gte to the target date.

The optional 'skew' parameter provides for incrementing today's
date a number of days into the future. An example use case might
be sending a final notice email a few days before terminating an
instance, or snapshotting a volume prior to deletion.

The optional 'skew_hours' parameter provides for incrementing the current
time a number of hours into the future.

Optionally, the 'tz' parameter can get used to specify the timezone
in which to interpret the clock (default value is 'utc')

.. code-block :: yaml

  policies:
    - name: ec2-stop-marked
      resource: ec2
      filters:
        - type: marked-for-op
          # The default tag used is maid_status
          # but that is configurable
          tag: custodian_status
          op: stop
          # Another optional tag is skew
          tz: utc
      actions:
        - type: stop

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      op:
        type: string
      skew:
        minimum: 0
        type: number
      skew_hours:
        minimum: 0
        type: number
      tag:
        type: string
      type:
        enum:
        - marked-for-op
      tz:
        type: string
    required:
    - type



.. _AWS Cloud Control.common.filters.reduce:

reduce
++++++

Generic reduce filter to group, sort, and limit your resources.

This example will select the longest running instance from each ASG,
then randomly choose 10% of those, maxing at 15 total instances.

:example:

.. code-block:: yaml

  - name: oldest-instance-by-asg
    resource: ec2
    filters:
      - "tag:aws:autoscaling:groupName": present
      - type: reduce
        group-by: "tag:aws:autoscaling:groupName"
        sort-by: "LaunchTime"
        order: asc
        limit: 1

Or you might want to randomly select a 10 percent of your resources,
but no more than 15.

:example:

.. code-block:: yaml

  - name: random-selection
    resource: ec2
    filters:
      - type: reduce
        order: randomize
        limit: 15
        limit-percent: 10

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      discard:
        minimum: 0
        type: number
      discard-percent:
        maximum: 100
        minimum: 0
        type: number
      group-by:
        oneOf:
        - type: string
        - key:
            type: string
          type: object
          value_regex: string
          value_type:
            enum:
            - string
            - number
            - date
      limit:
        minimum: 0
        type: number
      limit-percent:
        maximum: 100
        minimum: 0
        type: number
      null-order:
        enum:
        - first
        - last
      order:
        enum:
        - asc
        - desc
        - reverse
        - randomize
      sort-by:
        oneOf:
        - type: string
        - key:
            type: string
          type: object
          value_regex: string
          value_type:
            enum:
            - string
            - number
            - date
      type:
        enum:
        - reduce
    required:
    - type



.. _AWS Cloud Control.common.filters.tag-count:

tag-count
+++++++++

Simplify tag counting..

ie. these two blocks are equivalent

.. code-block :: yaml

   - filters:
       - type: value
         op: gte
         count: 8

   - filters:
       - type: tag-count
         count: 8

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      count:
        minimum: 0
        type: integer
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - tag-count
    required:
    - type



.. _AWS Cloud Control.common.filters.value:

value
+++++

Generic value filter using jmespath
    

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - value
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type


